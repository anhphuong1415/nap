<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="Decription" content="BLOCKLY TRY OUT">
    <link rel="stylesheet" type="text/css" href="webview.css">
    <link rel="stylesheet" href="toolbox_style.css">
    <script src="node_modules/blockly/blockly_compressed.js"></script>
    <script src="node_modules/blockly/blocks_compressed.js"></script>
    <script src="node_modules/blockly/javascript_compressed.js"></script>
    <script src="toolbox_standard.js"></script>
    <script src="node_modules/blockly/msg/vi.js"></script>
    <script src="CustomBlockForRange1.js"></script>
    <script src="GenneratorForRange.js"></script>
    <script src="custom_category_es6.js"></script>
    <script src="toolbox_label_es6.js"></script>
    <script src="theme.js"></script>

</head>

<body>
    <div style="width: 100%; height: 100vh">
        <xml id="toolbox" style="display: none">
            <category name="Di chuyển" colour="#a5745b">
                <block type="robot_move">
                    <field name="Direction">Foward</field>
                    <field name="Velocity">0</field>
                    <field name="Duration">0</field>
                </block>
                <block type="servo">
                    <field name="Servo_Select">Servo_1</field>
                    <field name="Angle">90</field>
                </block>
                <block type="motorselect">
                    <field name="MotorSelect">Left</field>
                    <field name="velocity">1</field>
                    <field name="duration">1</field>
                </block>
                <block type="stop_move"></block>
            </category>
            <category name="Biểu diễn" colour="#9fa55b">
                <block type="playmusicnote">
                    <field name="Note">C</field>
                    <field name="Duration">0</field>
                </block>
                <block type="ringled">
                    <field name="ringLedModule">module_1</field>
                    <field name="Led_1">#ff6666</field>
                    <field name="Led_2">#990000</field>
                    <field name="Led_3">#009900</field>
                    <field name="Led_4">#009900</field>
                    <field name="Led_5">#3366ff</field>
                    <field name="Led_6">#000099</field>
                    <field name="Led_7">#cc33cc</field>
                    <field name="Led_8">#66ffff</field>
                    <field name="Led_9">#ff99ff</field>
                    <field name="Led_10">#33cc00</field>
                    <field name="Led_11">#33ffff</field>
                    <field name="Led_12">#ffff66</field>
                </block>
                <block type="playwithmatrixledchar">
                    <field name="Port">Module_1</field>
                    <field name="char">A</field>
                </block>
                <block type="matrixlebspecialchar">
                    <field name="module">module_1</field>
                    <field name="NAME">OPTIONNAME</field>
                </block>
                <block type="rgb_led">
                    <field name="color">#00cccc</field>
                    <field name="duration">0</field>
                </block>
                <block type="turnoffledrbg">
                    <field name="On_Off">OPTIONNAME</field>
                </block>
            </category>
            <category name="Cảm biến" colour="#5ba55b">
                <block type="srf05">
                    <field name="port">OPTIONNAME</field>
                </block>
                <block type="light_sensor">
                    <field name="Port">OPTIONNAME</field>
                </block>
                <block type="colorsensor">
                    <field name="Port">OPTIONNAME</field>
                </block>
                <block type="sound_sensor">
                    <field name="Port">OPTIONNAME</field>
                </block>
                <block type="path_detecter">
                    <field name="Port">OPTIONNAME</field>
                    <field name="side">left</field>
                    <field name="color">white</field>
                </block>
            </category>
            <category name="Tính toán" colour="#5b67a5">
                <block type="logic_operation">
                    <field name="OP">AND</field>
                </block>
                <block type="math_number">
                    <field name="NUM">0</field>
                </block>
                <block type="math_arithmetic">
                    <field name="OP">ADD</field>
                    <value name="A">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                    <value name="B">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                </block>
                <block type="logic_compare">
                    <field name="OP">EQ</field>
                </block>
            </category>
            <category name="Điều khiển" colour="#5b80a5">
                <block type="if_block"></block>
                <block type="stop_move"></block>
                <block type="loop">
                    <field name="NAME">0</field>
                </block>
                <block type="break_continue_loop">
                    <field name="action">OPTIONNAME</field>
                </block>
                <block type="if1"></block>
                <block type="wait">
                    <field name="time">0</field>
                </block>
            </category>
            <category name="Hàm" colour="#995ba5">
                <block type="create_function">
                    <field name="Function_name">di chuyển</field>
                </block>
            </category>
            <category name="Dữ liệu" colour="#a55b80" custom="VARIABLE"></category>
        </xml>

        <div id="blocklyDiv" style="height: 100vh; width: 100vw;">
        </div>

        <script>
            var workspacePlayground = Blockly.inject('blocklyDiv', {
                media: 'media/',
                // toolbox: BLOCKLY_TOOLBOX_XML['standard'],
                toolbox: document.getElementById('toolbox'),
                collapse: true,
                comments: true,
                disable: true,
                maxBlocks: Infinity,
                trashcan: true,
                horizontalLayout: false,
                toolboxPosition: 'start',
                css: true,
                rtl: false,
                scrollbars: false,
                sounds: true,
                oneBasedIndex: true,
                zoom: {
                    controls: true,
                    wheel: true,
                    startScale: 1,
                    maxScale: 3,
                    minScale: 0.3,
                    scaleSpeed: 1.2
                },
                theme: Blockly.Themes.Halloween
            });

            function handleGenCode() {
                Blockly.JavaScript.addReservedWords('code');
                try {
                    var code = Blockly.JavaScript.workspaceToCode(workspacePlayground);
                    try {
                        eval(code);
                    } catch (error1) {
                        alert(error1)
                    }
                    // <!--                    document.getElementById("codeSpaceText").value = code;-->
                } catch (error) {
                    alert(error)
                }
            }

            function handleTmpSave() {
                let workspace = Blockly.getMainWorkspace();
                if (typeof(Storage) !== "undefined") {
                    localStorage.removeItem("storageTmp");
                    var xml = Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());
                    localStorage.setItem("storageTmp", Blockly.Xml.domToText(xml));
                } else {}
            }

            function handleTmpLOAD() {
                let workspace = Blockly.getMainWorkspace();
                workspace.clear();
                if (typeof(Storage) !== "undefined") {
                    // workspace.clear();
                    if (localStorage.storageTmp != null) {
                        // workspace.clear();
                        var xml = Blockly.Xml.textToDom(localStorage.getItem("storageTmp"));
                        Blockly.Xml.domToWorkspace(xml, workspace);
                    }
                }
            }

            function handleSave() {
                let workspace = Blockly.getMainWorkspace();
                if (typeof(Storage) !== "undefined") {
                    localStorage.removeItem("storage");
                    var xml = Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());
                    localStorage.setItem("storage", Blockly.Xml.domToText(xml));
                } else {
                    // Sorry! No Web Storage support..
                }
            }

            function handleLOAD() {
                let workspace = Blockly.getMainWorkspace();
                if (typeof(Storage) !== "undefined") {
                    if (localStorage.storage != null) {
                        workspace.clear();
                        var xml = Blockly.Xml.textToDom(localStorage.getItem("storage"));
                        Blockly.Xml.domToWorkspace(xml, workspace);
                    }
                }
            }
            // document.getElementById('genCodeCommand').addEventListener('click', handleGenCode)
        </script>

        <!-- <div style="margin-left: 50%; height: 600px;">
            <textarea rows="40" cols="80" id="codeSpaceText"></textarea>
        </div> -->
        <button id="RUN" onclick="handleGenCode()">
            <svg id = "RUN_ICON"
            viewBox="0 0 56.69 56.69"><defs><style>.cls-1{fill:#1f3f71;}.cls-2{fill:none;stroke:#62c3d0;stroke-miterlimit:10;}.cls-3{fill:#62c3d0;}</style></defs><title>Draw Icon</title><circle class="cls-1" cx="28.35" cy="28.35" r="28.35"/><circle class="cls-2" cx="28.35" cy="28.35" r="25.51"/><path class="cls-3" d="M19.05,10a4.83,4.83,0,0,0-2.48,2.13L16.1,13V43.37l.51.89a4.61,4.61,0,0,0,5.82,1.9C23.65,45.55,45.48,32,46,31.49a4.73,4.73,0,0,0,1.09-4.93c-.48-1.18-1.47-1.94-6.93-5.35L28.81,14.15c-3.33-2.07-6.38-3.9-6.79-4.07A4.5,4.5,0,0,0,19.05,10Z"/>
            </svg>
        </button>
        <button id="SAVE" onclick="handleSave()">
            <svg id = "SAVE_ICON"
            viewBox="0 0 56.69 57.15"><defs><style>.cls-1{fill:#1f3f71;}</style></defs><title>Draw Icon</title><path class="cls-1" d="M4,.22A5.17,5.17,0,0,0,.45,3.06C0,3.86,0,4.92,0,28.64S0,53.42.45,54.22a5.22,5.22,0,0,0,2.37,2.41l.93.52H52.8l1-.52a5.77,5.77,0,0,0,2.63-3.09c.38-1.27.38-35.51,0-37.06-.26-1-.84-1.66-7.7-8.54L41.3.53,40,.27A24.82,24.82,0,0,0,35.88.06L33.09.13,33,6c-.07,3.21-.17,5.89-.19,5.91s-.35.21-.75.42c-1,.52-17.27.54-18.28,0s-1.2-1.34-1.2-7.06V0L8.64,0C6.45.06,4.39.13,4,.22ZM43.88,24.53l.59.57V46.22l-.57.65-.56.66H13.21l-.56-.66-.57-.65V25.1l.59-.57.56-.58H43.32Z"/><path class="cls-1" d="M19.36,29.51a2.74,2.74,0,0,0-1.43,1.43,2.4,2.4,0,0,0,.91,2.37c.33.16,3.5.26,9.55.26h9.06L38,33a2.08,2.08,0,0,0,0-3l-.61-.56-8.82-.05C23.7,29.39,19.55,29.44,19.36,29.51Z"/><path class="cls-1" d="M18.54,38.57a2,2,0,0,0,0,3l.61.61H37.47l.57-.65a2.08,2.08,0,0,0,0-2.87L37.45,38H19.15Z"/><path class="cls-1" d="M24.31.34c-.19.21-.26,1.62-.21,4.51l.07,4.2,2.44.07c1.81,0,2.51,0,2.65-.24a28.88,28.88,0,0,0,.19-4.34c0-3.75,0-4.06-.45-4.29C28.3-.13,24.64-.06,24.31.34Z"/>
            </svg></button>
        <button id="LOAD" onclick="handleLOAD()">
            <svg id = "LOAD_ICON"
                 viewBox="0 0 56.69 57.15"><defs><style>.cls-1{fill:#1f3f71;}</style></defs><title>Draw Icon</title><path class="cls-1" d="M4,.22A5.17,5.17,0,0,0,.45,3.06C0,3.86,0,4.92,0,28.64S0,53.42.45,54.22a5.22,5.22,0,0,0,2.37,2.41l.93.52H52.8l1-.52a5.77,5.77,0,0,0,2.63-3.09c.38-1.27.38-35.51,0-37.06-.26-1-.84-1.66-7.7-8.54L41.3.53,40,.27A24.82,24.82,0,0,0,35.88.06L33.09.13,33,6c-.07,3.21-.17,5.89-.19,5.91s-.35.21-.75.42c-1,.52-17.27.54-18.28,0s-1.2-1.34-1.2-7.06V0L8.64,0C6.45.06,4.39.13,4,.22ZM43.88,24.53l.59.57V46.22l-.57.65-.56.66H13.21l-.56-.66-.57-.65V25.1l.59-.57.56-.58H43.32Z"/><path class="cls-1" d="M19.36,29.51a2.74,2.74,0,0,0-1.43,1.43,2.4,2.4,0,0,0,.91,2.37c.33.16,3.5.26,9.55.26h9.06L38,33a2.08,2.08,0,0,0,0-3l-.61-.56-8.82-.05C23.7,29.39,19.55,29.44,19.36,29.51Z"/><path class="cls-1" d="M18.54,38.57a2,2,0,0,0,0,3l.61.61H37.47l.57-.65a2.08,2.08,0,0,0,0-2.87L37.45,38H19.15Z"/><path class="cls-1" d="M24.31.34c-.19.21-.26,1.62-.21,4.51l.07,4.2,2.44.07c1.81,0,2.51,0,2.65-.24a28.88,28.88,0,0,0,.19-4.34c0-3.75,0-4.06-.45-4.29C28.3-.13,24.64-.06,24.31.34Z"/>
            </svg></button>
        </button>
    </div>
</body>

</html>