<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="Decription" content="BLOCKLY TRY OUT">
    <link rel="stylesheet" type="text/css" href="webview.css">
    <link rel="stylesheet" href="toolbox_style.css">
    <script src="node_modules/blockly/blockly_compressed.js"></script>
    <script src="node_modules/blockly/blocks_compressed.js"></script>
    <script src="node_modules/blockly/javascript_compressed.js"></script>
    <script src="toolbox_standard.js"></script>
    <script src="node_modules/blockly/msg/vi.js"></script>
    <script src="CustomBlockForRange1.js"></script>
    <script src="GenneratorForRange.js"></script>
    <script src="custom_category_es6.js"></script>
    <script src="toolbox_label_es6.js"></script>
    <script src="theme.js"></script>

</head>
<body>
    <div style="width: 100%; height: 100vh">
        <xml id="toolbox" style="display: none">
            <category name="Di chuyển" colour="#a5745b">
                <block type="robot_move">
                    <field name="Direction">Foward</field>
                    <field name="Velocity">0</field>
                    <field name="Duration">0</field>
                </block>
                <block type="servo">
                    <field name="Servo_Select">Servo_1</field>
                    <field name="Angle">90</field>
                </block>
                <block type="motorselect">
                    <field name="MotorSelect">Left</field>
                    <field name="velocity">1</field>
                    <field name="duration">1</field>
                </block>
                <block type="stop_move"></block>
            </category>
            <category name="Biểu diễn" colour="#9fa55b">
                <block type="playmusicnote">
                    <field name="Note">C</field>
                    <field name="Duration">0</field>
                </block>
                <block type="ringled">
                    <field name="ringLedModule">module_1</field>
                    <field name="Led_1">#ff6666</field>
                    <field name="Led_2">#990000</field>
                    <field name="Led_3">#009900</field>
                    <field name="Led_4">#009900</field>
                    <field name="Led_5">#3366ff</field>
                    <field name="Led_6">#000099</field>
                    <field name="Led_7">#cc33cc</field>
                    <field name="Led_8">#66ffff</field>
                    <field name="Led_9">#ff99ff</field>
                    <field name="Led_10">#33cc00</field>
                    <field name="Led_11">#33ffff</field>
                    <field name="Led_12">#ffff66</field>
                </block>
                <block type="playwithmatrixledchar">
                    <field name="Port">Module_1</field>
                    <field name="char">A</field>
                </block>
                <block type="matrixlebspecialchar">
                    <field name="module">module_1</field>
                    <field name="NAME">OPTIONNAME</field>
                </block>
                <block type="rgb_led">
                    <field name="color">#00cccc</field>
                    <field name="duration">0</field>
                </block>
                <block type="turnoffledrbg">
                    <field name="On_Off">OPTIONNAME</field>
                </block>
            </category>
            <category name="Cảm biến" colour="#5ba55b">
                <block type="srf05">
                    <field name="port">OPTIONNAME</field>
                </block>
                <block type="light_sensor">
                    <field name="Port">OPTIONNAME</field>
                </block>
                <block type="colorsensor">
                    <field name="Port">OPTIONNAME</field>
                </block>
                <block type="sound_sensor">
                    <field name="Port">OPTIONNAME</field>
                </block>
                <block type="path_detecter">
                    <field name="Port">OPTIONNAME</field>
                    <field name="side">left</field>
                    <field name="color">white</field>
                </block>
            </category>
            <category name="Tính toán" colour="#5b67a5">
                <block type="logic_operation">
                    <field name="OP">AND</field>
                </block>
                <block type="math_number">
                    <field name="NUM">0</field>
                </block>
                <block type="math_arithmetic">
                    <field name="OP">ADD</field>
                    <value name="A">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                    <value name="B">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                </block>
                <block type="logic_compare">
                    <field name="OP">EQ</field>
                </block>
            </category>
            <category name="Điều khiển" colour="#5b80a5">
                <block type="if_block"></block>
                <block type="stop_move"></block>
                <block type="loop">
                    <field name="NAME">0</field>
                </block>
                <block type="break_continue_loop">
                    <field name="action">OPTIONNAME</field>
                </block>
                <block type="if1"></block>
                <block type="wait">
                    <field name="time">0</field>
                </block>
            </category>
            <category name="Hàm" colour="#995ba5">
                <block type="create_function">
                    <field name="Function_name">di chuyển</field>
                </block>
            </category>
            <category name="Dữ liệu" colour="#a55b80" custom="VARIABLE"></category>
<!--            <category name="Logic" colour="#5b80a5">-->
<!--                <block type="controls_if"></block>-->
<!--                <block type="logic_compare">-->
<!--                    <field name="OP">EQ</field>-->
<!--                </block>-->
<!--                <block type="logic_operation">-->
<!--                    <field name="OP">AND</field>-->
<!--                </block>-->
<!--                <block type="logic_negate"></block>-->
<!--                <block type="logic_boolean">-->
<!--                    <field name="BOOL">TRUE</field>-->
<!--                </block>-->
<!--                <block type="logic_null"></block>-->
<!--                <block type="logic_ternary"></block>-->
<!--            </category>-->
<!--            <category name="Loops" colour="#5ba55b">-->
<!--                <block type="controls_repeat_ext">-->
<!--                    <value name="TIMES">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">10</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="controls_whileUntil">-->
<!--                    <field name="MODE">WHILE</field>-->
<!--                </block>-->
<!--                <block type="controls_for">-->
<!--                    <field name="VAR" id="|XfV3%Q}wJ#G6gk-:XzY">i</field>-->
<!--                    <value name="FROM">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">1</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="TO">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">10</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="BY">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">1</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="controls_forEach">-->
<!--                    <field name="VAR" id="YR2a[kir!aAFagnW-GhP">j</field>-->
<!--                </block>-->
<!--                <block type="controls_flow_statements">-->
<!--                    <field name="FLOW">BREAK</field>-->
<!--                </block>-->
<!--            </category>-->
<!--            <category name="Math" colour="#5b67a5">-->
<!--                <block type="math_number">-->
<!--                    <field name="NUM">0</field>-->
<!--                </block>-->
<!--                <block type="math_arithmetic">-->
<!--                    <field name="OP">ADD</field>-->
<!--                    <value name="A">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">1</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="B">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">1</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="math_single">-->
<!--                    <field name="OP">ROOT</field>-->
<!--                    <value name="NUM">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">9</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="math_trig">-->
<!--                    <field name="OP">SIN</field>-->
<!--                    <value name="NUM">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">45</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="math_constant">-->
<!--                    <field name="CONSTANT">PI</field>-->
<!--                </block>-->
<!--                <block type="math_number_property">-->
<!--                    <mutation divisor_input="false"></mutation>-->
<!--                    <field name="PROPERTY">EVEN</field>-->
<!--                    <value name="NUMBER_TO_CHECK">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">0</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="math_round">-->
<!--                    <field name="OP">ROUND</field>-->
<!--                    <value name="NUM">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">3.1</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="math_on_list">-->
<!--                    <mutation op="SUM"></mutation>-->
<!--                    <field name="OP">SUM</field>-->
<!--                </block>-->
<!--                <block type="math_modulo">-->
<!--                    <value name="DIVIDEND">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">64</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="DIVISOR">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">10</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="math_constrain">-->
<!--                    <value name="VALUE">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">50</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="LOW">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">1</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="HIGH">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">100</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="math_random_int">-->
<!--                    <value name="FROM">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">1</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="TO">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">100</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="math_random_float"></block>-->
<!--            </category>-->
<!--            <category name="Text" colour="#5ba58c">-->
<!--                <block type="text">-->
<!--                    <field name="TEXT"></field>-->
<!--                </block>-->
<!--                <block type="text_join">-->
<!--                    <mutation items="2"></mutation>-->
<!--                </block>-->
<!--                <block type="text_append">-->
<!--                    <field name="VAR" id="[2@7T=v9ll5Qkd63?4|%">item</field>-->
<!--                    <value name="TEXT">-->
<!--                        <shadow type="text">-->
<!--                            <field name="TEXT"></field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="text_length">-->
<!--                    <value name="VALUE">-->
<!--                        <shadow type="text">-->
<!--                            <field name="TEXT">abc</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="text_isEmpty">-->
<!--                    <value name="VALUE">-->
<!--                        <shadow type="text">-->
<!--                            <field name="TEXT"></field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="text_indexOf">-->
<!--                    <field name="END">FIRST</field>-->
<!--                    <value name="VALUE">-->
<!--                        <block type="variables_get">-->
<!--                            <field name="VAR" id="*H!qJ8lc8(d:{*N]U5XH">text</field>-->
<!--                        </block>-->
<!--                    </value>-->
<!--                    <value name="FIND">-->
<!--                        <shadow type="text">-->
<!--                            <field name="TEXT">abc</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="text_charAt">-->
<!--                    <mutation at="true"></mutation>-->
<!--                    <field name="WHERE">FROM_START</field>-->
<!--                    <value name="VALUE">-->
<!--                        <block type="variables_get">-->
<!--                            <field name="VAR" id="*H!qJ8lc8(d:{*N]U5XH">text</field>-->
<!--                        </block>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="text_getSubstring">-->
<!--                    <mutation at1="true" at2="true"></mutation>-->
<!--                    <field name="WHERE1">FROM_START</field>-->
<!--                    <field name="WHERE2">FROM_START</field>-->
<!--                    <value name="STRING">-->
<!--                        <block type="variables_get">-->
<!--                            <field name="VAR" id="*H!qJ8lc8(d:{*N]U5XH">text</field>-->
<!--                        </block>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="text_changeCase">-->
<!--                    <field name="CASE">UPPERCASE</field>-->
<!--                    <value name="TEXT">-->
<!--                        <shadow type="text">-->
<!--                            <field name="TEXT">abc</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="text_trim">-->
<!--                    <field name="MODE">BOTH</field>-->
<!--                    <value name="TEXT">-->
<!--                        <shadow type="text">-->
<!--                            <field name="TEXT">abc</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="text_print">-->
<!--                    <value name="TEXT">-->
<!--                        <shadow type="text">-->
<!--                            <field name="TEXT">abc</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="text_prompt_ext">-->
<!--                    <mutation type="TEXT"></mutation>-->
<!--                    <field name="TYPE">TEXT</field>-->
<!--                    <value name="TEXT">-->
<!--                        <shadow type="text">-->
<!--                            <field name="TEXT">abc</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--            </category>-->
<!--            <category name="Lists" colour="#745ba5">-->
<!--                <block type="lists_create_with">-->
<!--                    <mutation items="0"></mutation>-->
<!--                </block>-->
<!--                <block type="lists_create_with">-->
<!--                    <mutation items="3"></mutation>-->
<!--                </block>-->
<!--                <block type="lists_repeat">-->
<!--                    <value name="NUM">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">5</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="lists_length"></block>-->
<!--                <block type="lists_isEmpty"></block>-->
<!--                <block type="lists_indexOf">-->
<!--                    <field name="END">FIRST</field>-->
<!--                    <value name="VALUE">-->
<!--                        <block type="variables_get">-->
<!--                            <field name="VAR" id="5@i{HzC(/GPou?70ILlQ">list</field>-->
<!--                        </block>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="lists_getIndex">-->
<!--                    <mutation statement="false" at="true"></mutation>-->
<!--                    <field name="MODE">GET</field>-->
<!--                    <field name="WHERE">FROM_START</field>-->
<!--                    <value name="VALUE">-->
<!--                        <block type="variables_get">-->
<!--                            <field name="VAR" id="5@i{HzC(/GPou?70ILlQ">list</field>-->
<!--                        </block>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="lists_setIndex">-->
<!--                    <mutation at="true"></mutation>-->
<!--                    <field name="MODE">SET</field>-->
<!--                    <field name="WHERE">FROM_START</field>-->
<!--                    <value name="LIST">-->
<!--                        <block type="variables_get">-->
<!--                            <field name="VAR" id="5@i{HzC(/GPou?70ILlQ">list</field>-->
<!--                        </block>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="lists_getSublist">-->
<!--                    <mutation at1="true" at2="true"></mutation>-->
<!--                    <field name="WHERE1">FROM_START</field>-->
<!--                    <field name="WHERE2">FROM_START</field>-->
<!--                    <value name="LIST">-->
<!--                        <block type="variables_get">-->
<!--                            <field name="VAR" id="5@i{HzC(/GPou?70ILlQ">list</field>-->
<!--                        </block>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="lists_split">-->
<!--                    <mutation mode="SPLIT"></mutation>-->
<!--                    <field name="MODE">SPLIT</field>-->
<!--                    <value name="DELIM">-->
<!--                        <shadow type="text">-->
<!--                            <field name="TEXT">,</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="lists_sort">-->
<!--                    <field name="TYPE">NUMERIC</field>-->
<!--                    <field name="DIRECTION">1</field>-->
<!--                </block>-->
<!--            </category>-->
<!--            <category name="Colour" colour="#a5745b">-->
<!--                <block type="colour_picker">-->
<!--                    <field name="COLOUR">#ff0000</field>-->
<!--                </block>-->
<!--                <block type="colour_random"></block>-->
<!--                <block type="colour_rgb">-->
<!--                    <value name="RED">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">100</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="GREEN">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">50</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="BLUE">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">0</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--                <block type="colour_blend">-->
<!--                    <value name="COLOUR1">-->
<!--                        <shadow type="colour_picker">-->
<!--                            <field name="COLOUR">#ff0000</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="COLOUR2">-->
<!--                        <shadow type="colour_picker">-->
<!--                            <field name="COLOUR">#3333ff</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                    <value name="RATIO">-->
<!--                        <shadow type="math_number">-->
<!--                            <field name="NUM">0.5</field>-->
<!--                        </shadow>-->
<!--                    </value>-->
<!--                </block>-->
<!--            </category>-->
<!--            <sep></sep>-->
<!--            <category name="Variables" colour="#a55b80" custom="VARIABLE"></category>-->
<!--            <category name="Command" colour="#745ba5">-->
<!--                <block type="move">-->
<!--                    <field name="Mode">distance</field>-->
<!--                </block>-->
<!--                <block type="playmusicnote">-->
<!--                    <field name="Note">Đô</field>-->
<!--                </block>-->
<!--                <block type="playwithled">-->
<!--                    <field name="TranferMode">LeftMode</field>-->
<!--                </block>-->
<!--                <block type="rgb_led"></block>-->
<!--                <block type="dir">-->
<!--                    <field name="Dir">LEFT</field>-->
<!--                </block>-->
<!--            </category>-->
        </xml>

        <div id="blocklyDiv" style="height: 100vh; width: 100vw;">
        </div>
        <script>
            // Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),
            //     workspacePlayground);

            var workspacePlayground = Blockly.inject('blocklyDiv', {
                media: 'media/',
                // toolbox: BLOCKLY_TOOLBOX_XML['standard'],
                toolbox: document.getElementById('toolbox'),
                collapse: true,
                comments: true,
                disable: true,
                maxBlocks: Infinity,
                trashcan: true,
                horizontalLayout: false,
                toolboxPosition: 'start',
                css: true,
                rtl: false,
                scrollbars: false,
                sounds: true,
                oneBasedIndex: true,
<!--                grid: {-->
<!--                    spacing: 20,-->
<!--                    length: 1,-->
<!--                    colour: '#888',-->
<!--                    snap: false-->
<!--                },-->
                zoom: {
                    controls: true,
                    wheel: true,
                    startScale: 1,
                    maxScale: 3,
                    minScale: 0.3,
                    scaleSpeed: 1.2
                },
                theme: Blockly.Themes.Halloween
            });

            function handleGenCode() {
                Blockly.JavaScript.addReservedWords('code');
                try {
                    var code = Blockly.JavaScript.workspaceToCode(workspacePlayground);
                    try{
                        eval(code);
                    }
                    catch(error1){
                        alert(error1)
                     }
                    // document.getElementById("codeSpaceText").value = code;
                } catch (error) {
                    alert(error)
                }
                // document.getElementById("codeSpaceText").value = code;
            }

            function handleTmpSave() {
                // document.getElementById("LOAD").blocklyXml = Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());
                let workspace = Blockly.getMainWorkspace();
<!--                workspace.clear();-->
                if (typeof(Storage) !== "undefined") {
                    localStorage.removeItem("storageTmp");
                    var xml = Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());
                    localStorage.setItem("storageTmp", Blockly.Xml.domToText(xml));
                } else {
                }
            }

            function handleTmpLOAD() {
                let workspace = Blockly.getMainWorkspace();
                workspace.clear();
                if (typeof(Storage) !== "undefined") {
                    // workspace.clear();
                    if (localStorage.storageTmp != null) {
                        // workspace.clear();
                        var xml = Blockly.Xml.textToDom(localStorage.getItem("storageTmp"));
                        Blockly.Xml.domToWorkspace(xml, workspace);
                    }
                }
            }

            function handleSave() {
                let workspace = Blockly.getMainWorkspace();
                if (typeof(Storage) !== "undefined") {
                    localStorage.removeItem("storage");
                    var xml = Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace());
                    localStorage.setItem("storage", Blockly.Xml.domToText(xml));
                } else {
                    // Sorry! No Web Storage support..
                }
            }

            function handleLOAD() {
                let workspace = Blockly.getMainWorkspace();
                if (typeof(Storage) !== "undefined") {
                    if (localStorage.storage != null) {
                        workspace.clear();
                        var xml = Blockly.Xml.textToDom(localStorage.getItem("storage"));
                        Blockly.Xml.domToWorkspace(xml, workspace);
                    }
                }
            }
            // document.getElementById('genCodeCommand').addEventListener('click', handleGenCode)
        </script>

        <!-- <div style="margin-left: 50%; height: 600px;">
            <textarea rows="40" cols="80" id="codeSpaceText"></textarea>
        </div> -->
        <button id="RUN" onclick="handleGenCode()">RUN</button>
        <button id="SAVE" onclick="handleSave()">SAVE</button>
        <button id="LOAD" onclick="handleLOAD()">LOAD</button>
    </div>
    <!-- <script src="Main.js"></script> -->
</body>

</html>